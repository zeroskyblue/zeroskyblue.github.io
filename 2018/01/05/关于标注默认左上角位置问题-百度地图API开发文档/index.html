<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>关于标注默认左上角位置问题-百度地图API开发文档 | 你若安好 便是晴天</title><meta name="description"><meta name="generator" content="你若安好 便是晴天"><meta name="author" content="zeroskyblue"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><a href="/"><img src="/images/ben.jpg" alt="你若安好 便是晴天" title="你若安好 便是晴天"></a><h1><a href="/" alt="你若安好 便是晴天" title="你若安好 便是晴天" itemprop="headline">你若安好 便是晴天</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/" alt="Home" title="Home" itemprop="url">Home</a></li><li itemprop="name"><a href="/articles" alt="Articles" title="Articles" itemprop="url">Articles</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url">About</a></li></ul></nav><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">关于标注默认左上角位置问题-百度地图API开发文档</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2018-01-05T01:52:11.000Z"> Friday, January 5th 2018 at 9:52</time><br>Last updated on<time itemprop="dateModified" datetime="2018-01-05T01:52:11.000Z"> Friday, January 5th 2018 at 10:52</time></span><p>1.先看我做的例子<br><img src="/images/mymap1.png" alt="百度地图例子1"><br><img src="/images/mymap2.png" alt="百度地图例子2"></p>
<p>2百度搜“百度地图API”关键字(图1),跳转到<a href="http://lbsyun.baidu.com/index.php?title=jspopular" target="_blank" rel="noopener">百度地图接口API链接</a>，此时可以看到了地图展示的例子（图2），那我先找“示例DEMO”点击进去（图3）<br><img src="/images/maplink.png" alt="图1"><br><img src="/images/maplink1.png" alt="图2"><br><img src="/images/maplink2.png" alt="图3"></p>
<p>3.新建一个html文件，将“地图展示”源代码拷贝过来贴调试下，若想调用百度地图API，需要获取密钥（图4）<br><img src="/images/maplink3.png" alt="密钥图"></p>
<p>4.获取密钥的方法请看如图所示，按照下面的步骤申请获取密钥就行<br><img src="/images/maplink4.png" alt="密钥"></p>
<p>5.获取密钥后运行建好的html文件看看下效果图<br><img src="/images/mapic1.png" alt="效果图1"><br><img src="/images/mapic2.png" alt="效果图2"></p>
<p>6.在地图加上标注,将这段代码加上就行<br><img src="/images/maplink5.png" alt="标注代码"></p>
<ol>
<li><p>添加标注之后，再次运行效果图<br><img src="/images/mappicsign1.png" alt="标注1"><br><img src="/images/mappicsign2.png" alt="标注2"></p>
</li>
<li><p>标注根据经纬度定位,两个参数分别是经度和纬度，至于想如何获取你想要的定位自行百度吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var point = new BMap.Point(116.404, 39.915);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>9.按F12查看浏览器console，加载的时候显示下面的2个waring<br><img src="/images/mapwarn.png" alt="waring"></p>
<p>10.若想去掉这2个waring,解决方案就是把加载地图js的方式改为异步刷新加载地图就行<br><img src="/images/maplink6.png" alt="异步刷新加载地图"></p>
<p>11.异步刷新加载地图,按F12查看console问题就不见了，完美~~~<br><img src="/images/maplink7.png" alt="异步刷新加载地图效果图"></p>
<p>12.贴上我的源代码例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"initial-scale=1.0, user-scalable=no"</span> /&gt;</span><br><span class="line">    &lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">        body, html,<span class="comment">#allmap &#123;width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";&#125;</span></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;!--&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"http://api.map.baidu.com/api?v=2.0&amp;ak=xxxxxxxxxxxx"</span>&gt;&lt;/script&gt;--&gt;</span><br><span class="line">    &lt;title&gt;地图展示&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">"allmap"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;!--&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    // 百度地图API功能</span><br><span class="line">    var map = new BMap.Map(<span class="string">"allmap"</span>);    // 创建Map实例</span><br><span class="line">    map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别</span><br><span class="line"></span><br><span class="line">    //标注</span><br><span class="line">    var point = new BMap.Point(116.404, 39.915);</span><br><span class="line">    map.centerAndZoom(point, 15);</span><br><span class="line">    var marker = new BMap.Marker(point);        // 创建标注</span><br><span class="line">    map.addOverlay(marker);                     // 将标注添加到地图中</span><br><span class="line"></span><br><span class="line">    //添加地图类型控件</span><br><span class="line">    map.addControl(new BMap.MapTypeControl(&#123;</span><br><span class="line">        mapTypes:[</span><br><span class="line">            BMAP_NORMAL_MAP,</span><br><span class="line">            BMAP_HYBRID_MAP</span><br><span class="line">        ]&#125;));</span><br><span class="line">    map.setCurrentCity(<span class="string">"北京"</span>);          // 设置地图显示的城市 此项是必须设置的</span><br><span class="line">    map.enableScrollWheelZoom(<span class="literal">true</span>);     //开启鼠标滚轮缩放</span><br><span class="line">&lt;/script&gt;--&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    //百度地图API功能</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">loadJScript</span></span>() &#123;</span><br><span class="line">        var script = document.createElement(<span class="string">"script"</span>);</span><br><span class="line">        script.type = <span class="string">"text/javascript"</span>;</span><br><span class="line">        script.src = <span class="string">"http://api.map.baidu.com/api?v=2.0&amp;ak=xxxxxxxxxxxx&amp;callback=init"</span>;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">init</span></span>() &#123;</span><br><span class="line">        var map = new BMap.Map(<span class="string">"allmap"</span>);            // 创建Map实例</span><br><span class="line">        var point = new BMap.Point(116.404, 39.915); // 创建点坐标</span><br><span class="line">        //标注</span><br><span class="line">        var marker = new BMap.Marker(point);        // 创建标注</span><br><span class="line">        map.addOverlay(marker);                     // 将标注添加到地图中</span><br><span class="line">        map.centerAndZoom(point,15);</span><br><span class="line">        map.enableScrollWheelZoom();                 //启用滚轮放大缩小</span><br><span class="line">        //添加地图类型控件</span><br><span class="line">        map.addControl(new BMap.MapTypeControl(&#123;</span><br><span class="line">            mapTypes:[</span><br><span class="line">                BMAP_NORMAL_MAP,</span><br><span class="line">                BMAP_HYBRID_MAP</span><br><span class="line">            ]&#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    window.onload = loadJScript;  //异步加载地图</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>####关于标注默认左上角位置问题<br>加载地图的时候标注位置没有居中，在地图左上角<br>这是一般在隐藏状态下创建的地图，这样会导致地图容器为0，在宽高为0的容器上，中心点自然也是0了，即容器的左上角。所以只能在可视的情况下创建地图，解决方案是给容器div属性display为block，问题就解决了。</p>
<p>最后，这解决方案放在我自己的项目里面似乎反而出现其他的问题：<br>加了block时，加载时地图默认为显示，和我预期的结果不符合；我想做的是加载地图完后先隐藏地图，点击切换按钮就显示百度地图</p>
<p>最终解决方案是：改变异步刷新过程<br>只可意会不可言传<br>还是贴上js代码吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=OcQprMl06yfiU9mmu88uGtSeVWPZTaUq&amp;callback=init&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    /*//百度地图API功能</span><br><span class="line">    function loadJScript() &#123;</span><br><span class="line">        var script = document.createElement(&quot;script&quot;);</span><br><span class="line">        script.type = &quot;text/javascript&quot;;</span><br><span class="line">        script.src = &quot;http://api.map.baidu.com/api?v=2.0&amp;ak=OcQprMl06yfiU9mmu88uGtSeVWPZTaUq&amp;callback=init&quot;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">    &#125;*/</span><br><span class="line">    function init() &#123;</span><br><span class="line">        var map = new BMap.Map(&quot;allmap&quot;);            // 创建Map实例</span><br><span class="line">        var point = new BMap.Point(116.988501,39.106211); // 创建点坐标</span><br><span class="line">        //标注</span><br><span class="line">        var marker = new BMap.Marker(point);  // 创建标注</span><br><span class="line">        map.addOverlay(marker);              // 将标注添加到地图中</span><br><span class="line">        map.centerAndZoom(point,15);         //设置中心点坐标和地图级别</span><br><span class="line">        map.enableScrollWheelZoom();                 //启用滚轮放大缩小</span><br><span class="line">        //添加地图类型控件</span><br><span class="line">        var mapType1 = new BMap.MapTypeControl(&#123;mapTypes: [BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]&#125;);</span><br><span class="line">        map.addControl(mapType1);          //2D图，卫星图</span><br><span class="line">        map.setCurrentCity(&quot;天津&quot;);          // 设置地图显示的城市 此项是必须设置的</span><br><span class="line">    &#125;</span><br><span class="line">    // window.onload = loadJScript;  //异步加载地图</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
</article></main></body></html>